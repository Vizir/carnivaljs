<form ng-init="nestedFormIndex = {value: 0}" novalidate>
  <div ng-repeat="field in fields" ng-class="{ row: field.grid.newRow }">
    <div>
      <carnival-form-fields class="column small-{{ field.grid.columnSize }}" ng-show="field.grid.newRow"></carnival-form-fields>
      <carnival-form-fields-next class="column small-{{ fields[$index + 1].grid.columnSize }}" ng-show="!fields[$index + 1].grid.newRow && $index + 1 !== fields.length"></carnival-form-fields-next>
    </div>
    <label class="col-sm-2 control-label">
      <carnival-button label="{{ 'FORM_BUTTON_SAVE' | translate }}" style="success" size="small" ng-click="buttonAction()"></carnival-button>
    </label>
  </form>
  <fieldset>
    <legend>Relacionados</legend>
      <div ng-if="field.fieldFormType == 'related'" class="row" ng-repeat="field in fields">
        <label ng-if='canShow(field)' class="col-sm-2 control-label">
          {{ field.label }}
          <div class="col-sm-10" ng-switch="field.type">
            <!-- Fields -->
            <carnival-belongs-to-field ng-if='canShow(field)' ng-switch-when="belongsTo" entity="entity" field="field" datas="entity.datas" action="entity.action" related-resources="entity.relatedResources" state="{{state}}"></carnival-belongs-to-field>
            <carnival-has-many-field ng-if='canShow(field)' ng-switch-when="hasMany" entity="entity" field="field" datas="entity.datas" action="entity.action" related-resources="entity.relatedResources" state="{{state}}"></carnival-has-many-field>
          </div>
        </label>
      </div>
  </fieldset>
</div>

